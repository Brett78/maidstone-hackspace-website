workspace:
  base: /drone
  path: src

pipeline:
  tests:
    image: python:3.5

    environment:
      - POSTGRES_USER=mhackspace
      - USE_DOCKER=yes
      - DJANGO_SETTINGS_MODULE=config.settings.test
    commands:
      - cp -n env.example .env
      - pip install -r ./requirements/test.txt
      - python manage.py test mhackspace --verbosity 2

  publish:
    image: appleboy/drone-ssh
    host: maidstone-hackspace.org.uk
    # user: root
    # password: 1234
    port: 22
    script:
      - echo 'to be added'

services:
  mailhog:
    image: mailhog/mailhog
